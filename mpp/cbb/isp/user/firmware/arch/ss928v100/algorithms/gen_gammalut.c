/*
  Copyright (c), 2001-2022, Shenshu Tech. Co., Ltd.
 */
#include <math.h>
#include "isp_gammalut.h"
#include "ot_type.h"
#define MAX_BITS 20
static td_float power_curve(td_float input, td_float gamma_scale)
{
    td_float output;

    output = pow(input, gamma_scale);

    return output;
}

static td_u32 gamma_lut_x[257] = {
    0, 256, 512, 768, 1024, 1280, 1536, 1792, 2048, 2304, 2560, 2816, 3072, 3328, 3584,
    3840, 4096, 4352, 4608, 4864, 5120, 5376, 5632, 5888, 6144, 6400, 6656, 6912, 7168,
    7424, 7680, 7936, 8192, 8448, 8704, 8960, 9216, 9472, 9728, 9984, 10240, 10496, 10752,
    11008, 11264, 11520, 11776, 12032, 12288, 12544, 12800, 13056, 13312, 13568, 13824, 14080,
    14336, 14592, 14848, 15104, 15360, 15616, 15872, 16128, 16384, 16896, 17408, 17920, 18432,
    18944, 19456, 19968, 20480, 20992, 21504, 22016, 22528, 23040, 23552, 24064, 24576, 25088,
    25600, 26112, 26624, 27136, 27648, 28160, 28672, 29184, 29696, 30208, 30720, 31232, 31744,
    32256, 32768, 33792, 34816, 35840, 36864, 37888, 38912, 39936, 40960, 41984, 43008, 44032,
    45056, 46080, 47104, 48128, 49152, 50176, 51200, 52224, 53248, 54272, 55296, 56320, 57344,
    58368, 59392, 60416, 61440, 62464, 63488, 64512, 65536, 67584, 69632, 71680, 73728, 75776,
    77824, 79872, 81920, 83968, 86016, 88064, 90112, 92160, 94208, 96256, 98304, 100352, 102400,
    104448, 106496, 108544, 110592, 112640, 114688, 116736, 118784, 120832, 122880, 124928,
    126976, 129024, 131072, 135168, 139264, 143360, 147456, 151552, 155648, 159744, 163840,
    167936, 172032, 176128, 180224, 184320, 188416, 192512, 196608, 200704, 204800, 208896,
    212992, 217088, 221184, 225280, 229376, 233472, 237568, 241664, 245760, 249856, 253952,
    258048, 262144, 270336, 278528, 286720, 294912, 303104, 311296, 319488, 327680, 335872,
    344064, 352256, 360448, 368640, 376832, 385024, 393216, 401408, 409600, 417792, 425984,
    434176, 442368, 450560, 458752, 466944, 475136, 483328, 491520, 499712, 507904, 516096,
    524288, 540672, 557056, 573440, 589824, 606208, 622592, 638976, 655360, 671744, 688128,
    704512, 720896, 737280, 753664, 770048, 786432, 802816, 819200, 835584, 851968, 868352,
    884736, 901120, 917504, 933888, 950272, 966656, 983040, 999424, 1015808, 1032192, 1048576
};

td_void gen_lut(td_u32 *lut, td_u32 lut_len, td_u8 output_bits, td_float gamma_scale)
{
    td_u32 i;
    td_float gamma_in, gamma_out;
    td_float max_output;

    max_output = (td_float)(1L << output_bits) - 1.0;

    lut[0] = 0;
    for (i = 1; i < lut_len; i++) {
        gamma_in = (td_float)gamma_lut_x[i] / (td_float)(1 << MAX_BITS);
        gamma_out = power_curve(gamma_in, gamma_scale);
        lut[i] = (td_u32)(gamma_out * max_output);
        lut[i] = (td_u32)fmax(lut[i], 0);
        lut[i] = (td_u32)fmin(lut[i], max_output);
    }

    return;
}
